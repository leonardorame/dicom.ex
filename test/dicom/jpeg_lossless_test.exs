defmodule Dicom.JPEGLosslessTest do
  use ExUnit.Case

  alias Dicom.BinaryFormat

  @dht <<0xFF, 0xC4, 0x00, 0x14, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01>>

  @sof8 <<0xFF, 0xC3, 0x00, 0x0B, 0x08, 0x00, 0x02, 0x00, 0x02, 0x01, 0x11, 0x00>>
  @sof16 <<0xFF, 0xC3, 0x00, 0x0B, 0x10, 0x00, 0x02, 0x00, 0x02, 0x01, 0x11, 0x00>>

  @sos <<0xFF, 0xDA, 0x00, 0x08, 0x01, 0x01, 0x00, 0x01, 0x00, 0x00>>

  @scan <<0x55>>

  @eoi <<0xFF, 0xD9>>

  @frame8 <<0xFF, 0xD8>> <> @dht <> @sof8 <> @sos <> @scan <> @eoi
  @frame16 <<0xFF, 0xD8>> <> @dht <> @sof16 <> @sos <> @scan <> @eoi

  test "decode 8 bit" do
    assert BinaryFormat.decode_jpeg_lossless(@frame8) == <<129, 130, 131, 132>>
  end

  test "decode 16 bit" do
    assert BinaryFormat.decode_jpeg_lossless(@frame16) ==
             <<0x80, 0x01, 0x80, 0x02, 0x80, 0x03, 0x80, 0x04>>
  end
end
